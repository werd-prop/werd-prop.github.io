<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Unit Conversions | Rocket Propulsion Tools</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    body { margin: 0; padding: 16px; background: #f6f7f9; }
    .card { max-width: 860px; margin: 0 auto; background: white; border-radius: 16px; padding: 16px; box-shadow: 0 6px 20px rgba(0,0,0,.08); }
    h1 { font-size: 20px; margin: 0 0 10px; }
    .row { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 720px) { .row { grid-template-columns: 1.2fr 1fr 1fr; } }
    label { display:block; font-size: 12px; color:#444; margin-bottom:6px; }
    select, input { width: 100%; padding: 10px 12px; border: 1px solid #d0d6dd; border-radius: 12px; font-size: 16px; }
    .out { margin-top: 12px; padding: 12px; border-radius: 12px; background: #f3f4f6; }
    .mono { font-variant-numeric: tabular-nums; }
    .small { color:#555; font-size: 12px; line-height: 1.35; }
    .btns { display:flex; gap:10px; flex-wrap:wrap; margin-top: 10px; }
    button { padding: 10px 14px; border-radius: 12px; border: 1px solid #c7cdd6; background: #fff; font-size: 15px; cursor:pointer; }
    a { color:#0b57d0; text-decoration:none; }
    a:hover { text-decoration:underline; }
    .hidden { display:none; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Unit Conversions</h1>
    <div class="small">
      <a href="../../">← Back to Rocket Propulsion Tools</a>
    </div>

    <div style="height:10px"></div>

    <div class="row">
      <div>
        <label for="category">Category</label>
        <select id="category"></select>
      </div>

      <div>
        <label for="fromUnit">From</label>
        <select id="fromUnit"></select>
      </div>

      <div>
        <label for="toUnit">To</label>
        <select id="toUnit"></select>
      </div>
    </div>

    <div style="height:10px"></div>

    <div class="row" style="grid-template-columns: 1fr;">
      <div>
        <label for="value">Value</label>
        <input id="value" type="number" step="any" value="1" />
      </div>
    </div>

    <!-- Only used for Isp <-> exhaust velocity conversions -->
    <div id="g0Wrap" class="row hidden" style="grid-template-columns: 1fr;">
      <div>
        <label for="g0">Standard gravity g₀ (used for Isp ↔ c)</label>
        <input id="g0" type="number" step="any" value="9.80665" />
        <div class="small">c = Isp · g₀</div>
      </div>
    </div>

    <div class="btns">
      <button id="swapBtn">Swap</button>
      <button id="copyBtn">Copy result</button>
      <button id="resetBtn">Reset</button>
    </div>

    <div class="out" id="output">
      <div class="small">Choose a category, units, and enter a value.</div>
    </div>

    <div class="small" style="margin-top:10px">
      Notes:
      <ul>
        <li>Most categories are linear (multiplicative) conversions via a base unit.</li>
        <li>Temperature uses formulas (°C/°F/K/°R).</li>
        <li>Temperature gradient converts temperature *differences* per length (Δ°F ≠ Δ°C).</li>
        <li>Isp ↔ c uses c = Isp·g₀.</li>
      </ul>
    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const fmt = (x) => {
    if (!Number.isFinite(x)) return "—";
    const ax = Math.abs(x);
    if (ax !== 0 && (ax >= 1e6 || ax < 1e-4)) return x.toExponential(6);
    return x.toLocaleString(undefined, { maximumFractionDigits: 10 });
  };

  // --- Conversion model ---
  // Linear categories:
  // value_in_base = value * toBase[fromUnit]
  // out          = value_in_base * (1/toBase[toUnit])
  //
  // Special categories implement convert(value, from, to).
  const DB = {
    "Acceleration": { base: "m/s²", toBase: { "m/s²": 1, "ft/s²": 0.3048, "in/s²": 0.0254 } },
    "Area": { base: "m²", toBase: { "m²": 1, "ft²": 0.092903, "in²": 6.4516e-4 } },
    "Density": { base: "kg/m³", toBase: { "kg/m³": 1, "lbm/ft³": 16.0184, "lbm/in³": 2.76799e4 } },
    "Energy / Work / Heat": { base: "J", toBase: { "J": 1, "Btu": 1055.056, "kW·hr": 3.600e6, "ft·lbf": 1.355817, "cal": 4.1868, "kcal": 4186.8 } },
    "Force": { base: "N", toBase: { "N": 1, "lbf": 4.448221, "dyne": 1e-5, "kgf": 9.80665, "mN": 1e-3 } },
    "Length": { base: "m", toBase: { "m": 1, "ft": 0.3048, "in": 0.0254, "mile": 1609.344, "nmi": 1852.00, "mil": 2.54e-8, "µm": 1e-6, "au": 1.49600e11 } },
    "Mass": { base: "kg", toBase: { "kg": 1, "lbm": 0.4536, "g": 0.001, "slug": 14.5939 } },
    "Power": { base: "W", toBase: { "W": 1, "Btu/s": 0.2924, "J/s": 1, "kW": 1000, "cal/s": 4.186, "hp": 745.6998, "ft·lbf/s": 1.35581 } },
    "Pressure": { base: "Pa", toBase: { "Pa": 1, "bar": 1e5, "atm": 101325, "mmHg": 133.322, "MPa": 1e6, "psi": 6894.757 } },
    "Speed": { base: "m/s", toBase: { "m/s": 1, "ft/s": 0.3048, "in/s": 0.0254, "knot": 0.5144, "mph": 0.44704 } },
    "Specific Heat": { base: "J/(g·°C)", toBase: { "J/(g·°C)": 1, "g-cal/(g·°C)": 4.186, "Btu/(lbm·°F)": 4.186 } },
    "Time": { base: "s", toBase: { "s": 1, "min": 60, "hr": 3600, "day": 86400, "year": 3.1536e7 } },
    "Viscosity (dynamic)": { base: "kg/(m·s)", toBase: { "kg/(m·s)": 1, "cP": 1e-3, "lbf·s/ft²": 47.88025 } },
    "Viscosity (kinematic)": { base: "m²/s", toBase: { "m²/s": 1, "cSt": 1e-6 } },

    // --- Added rocket-friendly categories ---
    "Mass flow": {
      base: "kg/s",
      toBase: {
        "kg/s": 1,
        "kg/min": 1/60,
        "lbm/s": 0.45359237,
        "lbm/min": 0.45359237/60
      }
    },

    "Impulse": {
      base: "N·s",
      toBase: {
        "N·s": 1,
        "lbf·s": 4.4482216152605
      }
    },

    "Temperature gradient": {
      special: true,
      units: ["K/m","°C/m","K/km","°C/km","°F/ft","°F/m"],
      convert: (value, from, to) => {
        // Convert to base of K/m, then to target.
        // Key facts:
        //  - ΔK = Δ°C
        //  - Δ°F = (9/5)Δ°C  => Δ°C = (5/9)Δ°F
        //  - lengths: ft = 0.3048 m, km = 1000 m
        const toKm = (v, u) => {
          switch (u) {
            case "K/m":
            case "°C/m": return v; // ΔK/m
            case "K/km":
            case "°C/km": return v / 1000.0; // per km -> per m
            case "°F/m": return (v * (5/9)); // Δ°F/m -> Δ°C/m
            case "°F/ft": return (v * (5/9)) / 0.3048; // per ft -> per m
            default: return NaN;
          }
        };
        const fromKm = (vKm, u) => {
          switch (u) {
            case "K/m":
            case "°C/m": return vKm;
            case "K/km":
            case "°C/km": return vKm * 1000.0;
            case "°F/m": return vKm * (9/5);
            case "°F/ft": return (vKm * (9/5)) * 0.3048; // per m -> per ft
            default: return NaN;
          }
        };
        return fromKm(toKm(value, from), to);
      }
    },

    "Temperature": {
      special: true,
      units: ["°C","°F","K","°R"],
      convert: (value, from, to) => {
        const toK = (v, u) => {
          switch (u) {
            case "K":  return v;
            case "°C": return v + 273.15;
            case "°F": return (v - 32) * (5/9) + 273.15;
            case "°R": return v * (5/9);
            default: return NaN;
          }
        };
        const fromK = (k, u) => {
          switch (u) {
            case "K":  return k;
            case "°C": return k - 273.15;
            case "°F": return (k - 273.15) * (9/5) + 32;
            case "°R": return k * (9/5);
            default: return NaN;
          }
        };
        return fromK(toK(value, from), to);
      }
    },

    "Isp ↔ exhaust velocity (c)": {
      special: true,
      units: ["Isp (s)","c (m/s)","c (ft/s)"],
      convert: (value, from, to, g0) => {
        // Use g0 in m/s^2
        const g = Number(g0);
        if (!Number.isFinite(g) || g <= 0) return NaN;

        // Convert input to c in m/s
        let c_mps;
        if (from === "Isp (s)") c_mps = value * g;
        else if (from === "c (m/s)") c_mps = value;
        else if (from === "c (ft/s)") c_mps = value * 0.3048;
        else return NaN;

        // Convert c to requested output
        if (to === "Isp (s)") return c_mps / g;
        if (to === "c (m/s)") return c_mps;
        if (to === "c (ft/s)") return c_mps / 0.3048;
        return NaN;
      }
    }
  };

  function unitsForCategory(cat) {
    const obj = DB[cat];
    if (!obj) return [];
    if (obj.special) return obj.units.slice();
    return Object.keys(obj.toBase || {});
  }

  function showG0(cat) {
    const need = (cat === "Isp ↔ exhaust velocity (c)");
    $("g0Wrap").classList.toggle("hidden", !need);
  }

  function linearConvert(value, toBase, fromUnit, toUnit) {
    const a = toBase[fromUnit];
    const b = toBase[toUnit];
    if (!Number.isFinite(a) || !Number.isFinite(b) || b === 0) return NaN;
    // value * (toBase[from]) gives base; divide by toBase[to] to get target
    return value * (a / b);
  }

  function render() {
    const cat = $("category").value;
    const from = $("fromUnit").value;
    const to = $("toUnit").value;
    const v = Number($("value").value);

    if (!Number.isFinite(v)) {
      $("output").innerHTML = `<div class="small">Enter a valid nu
